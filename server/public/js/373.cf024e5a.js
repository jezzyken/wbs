"use strict";(self["webpackChunkclient"]=self["webpackChunkclient"]||[]).push([[373],{9412:function(e,t,s){s.r(t),s.d(t,{default:function(){return G}});var i=s(6103),a=s(7314),r=s(3698),o=s(2938),n=s(3180),l=s(4414),c=s(3449),u=s(3064),d=s(1289),m=s(174),h=s(6930),v=s(2756),p=s(4312),f=s(7150),A=s(1034),b=s(3307),k=s(72),g=s(7515),C=s(2699),x=s(4152),w=s(5803);const I=(0,w.A)(k.A,(0,g.P)("windowGroup","v-window-item","v-window"));var T=I.extend().extend().extend({name:"v-window-item",directives:{Touch:C.A},props:{disabled:Boolean,reverseTransition:{type:[Boolean,String],default:void 0},transition:{type:[Boolean,String],default:void 0},value:{required:!1}},data(){return{isActive:!1,inTransition:!1}},computed:{classes(){return this.groupClasses},computedTransition(){return this.windowGroup.internalReverse?"undefined"!==typeof this.reverseTransition?this.reverseTransition||"":this.windowGroup.computedTransition:"undefined"!==typeof this.transition?this.transition||"":this.windowGroup.computedTransition}},methods:{genDefaultSlot(){return(0,x.$c)(this)},genWindowItem(){return this.$createElement("div",{staticClass:"v-window-item",class:this.classes,directives:[{name:"show",value:this.isActive}],on:this.$listeners},this.genDefaultSlot())},onAfterTransition(){this.inTransition&&(this.inTransition=!1,this.windowGroup.transitionCount>0&&(this.windowGroup.transitionCount--,0===this.windowGroup.transitionCount&&(this.windowGroup.transitionHeight=void 0)))},onBeforeTransition(){this.inTransition||(this.inTransition=!0,0===this.windowGroup.transitionCount&&(this.windowGroup.transitionHeight=(0,x.Dg)(this.windowGroup.$el.clientHeight)),this.windowGroup.transitionCount++)},onTransitionCancelled(){this.onAfterTransition()},onEnter(e){this.inTransition&&this.$nextTick((()=>{this.computedTransition&&this.inTransition&&(this.windowGroup.transitionHeight=(0,x.Dg)(e.clientHeight))}))}},render(e){return e("transition",{props:{name:this.computedTransition},on:{beforeEnter:this.onBeforeTransition,afterEnter:this.onAfterTransition,enterCancelled:this.onTransitionCancelled,beforeLeave:this.onBeforeTransition,afterLeave:this.onAfterTransition,leaveCancelled:this.onTransitionCancelled,enter:this.onEnter}},this.showLazyContent((()=>[this.genWindowItem()])))}}),N=T.extend({name:"v-tab-item",props:{id:String},methods:{genWindowItem(){const e=T.options.methods.genWindowItem.call(this);return e.data.domProps=e.data.domProps||{},e.data.domProps.id=this.id||this.value,e}}}),y=s(8882),_=s(8943),$=s(7112),E=(s(8111),s(2489),function(){var e=this,t=e._self._c;return t(c.A,{staticClass:"px-6"},[t("div",{staticClass:"mb-6"},[t(i.A,{staticClass:"pa-0",attrs:{items:e.breadcrumbs,divider:"/"}})],1),t(r.A,{staticClass:"mb-6"},[t(o.OQ,[t(v.A,[t(l.A,{attrs:{cols:"12",sm:"6",md:"3"}},[t($.A,{attrs:{label:"Search",placeholder:"Account No. / Name",dense:"",outlined:"","hide-details":"","prepend-inner-icon":"mdi-magnify"},model:{value:e.search,callback:function(t){e.search=t},expression:"search"}})],1),t(l.A,{attrs:{cols:"12",sm:"6",md:"3"}},[t(p.A,{attrs:{items:e.statusItems,label:"Status",dense:"",outlined:"","hide-details":""},model:{value:e.statusFilter,callback:function(t){e.statusFilter=t},expression:"statusFilter"}})],1),t(l.A,{attrs:{cols:"12",sm:"6",md:"3"}},[t(p.A,{attrs:{items:e.puroks,label:"Purok",dense:"",outlined:"","hide-details":""},model:{value:e.purokFilter,callback:function(t){e.purokFilter=t},expression:"purokFilter"}})],1)],1),t(v.A,{staticClass:"mt-4"},[t(A.A),t(a.A,{staticClass:"mr-2",attrs:{text:""},on:{click:e.resetFilters}},[e._v("Reset")])],1)],1)],1),t(y.A,{staticClass:"mb-6",model:{value:e.activeTab,callback:function(t){e.activeTab=t},expression:"activeTab"}},[t(b.A,[e._v("Consumers")]),"admin"===e.userRole?t(b.A,[e._v("Archived Consumers")]):e._e()],1),t(_.A,{model:{value:e.activeTab,callback:function(t){e.activeTab=t},expression:"activeTab"}},[t(N,[t(r.A,[t(o.ri,{staticClass:"d-flex justify-space-between py-4"},[t("span",{staticClass:"text-h6"}),t(a.A,{attrs:{color:"primary"},on:{click:e.openAddDialog}},[t(h.A,{attrs:{left:""}},[e._v("mdi-plus")]),e._v("Add Consumer ")],1)],1),t(u.A,{attrs:{headers:e.headers,items:e.filteredConsumers,loading:e.loading,"items-per-page":10,"footer-props":{"items-per-page-options":[10,20,50],"show-first-last-page":!0}},scopedSlots:e._u([{key:"item.status",fn:function({item:s}){return[t(n.A,{attrs:{color:e.getStatusColor(s.status),small:"",label:"","text-color":"white"}},[e._v(" "+e._s(s.status)+" ")])]}},{key:"item.actions",fn:function({item:s}){return[t(a.A,{staticClass:"mr-2",attrs:{"x-small":"",text:"",color:"primary"},on:{click:function(t){return e.editConsumer(s)}}},[t(h.A,{attrs:{"x-small":"",left:""}},[e._v("mdi-pencil")]),e._v("Edit ")],1),"admin"===e.userRole?t(a.A,{attrs:{"x-small":"",text:"",color:"error"},on:{click:function(t){return e.confirmToggleArchive(s)}}},[t(h.A,{attrs:{"x-small":"",left:""}},[e._v("mdi-archive")]),e._v("Archive ")],1):e._e()]}}])})],1)],1),t(N,[t(r.A,[t(o.ri,{staticClass:"py-4"},[t("span",{staticClass:"text-h6"},[e._v("Archived Consumers")])]),t(u.A,{attrs:{headers:e.headers,items:e.filteredArchivedConsumers,loading:e.loading,"items-per-page":10,"footer-props":{"items-per-page-options":[10,20,50],"show-first-last-page":!0}},scopedSlots:e._u([{key:"item.status",fn:function({item:s}){return[t(n.A,{attrs:{color:e.getStatusColor(s.status),small:"",label:"","text-color":"white"}},[e._v(" "+e._s(s.status)+" ")])]}},{key:"item.actions",fn:function({item:s}){return["admin"===e.userRole?t(a.A,{attrs:{"x-small":"",text:"",color:"success"},on:{click:function(t){return e.confirmToggleArchive(s)}}},[t(h.A,{attrs:{"x-small":"",left:""}},[e._v("mdi-archive-restore")]),e._v("Restore ")],1):e._e()]}}])})],1)],1)],1),t(d.A,{attrs:{"max-width":"600px"},model:{value:e.dialog,callback:function(t){e.dialog=t},expression:"dialog"}},[t(r.A,[t(o.ri,[t("span",{staticClass:"text-h5"},[e._v(e._s(e.isEdit?"Edit Consumer":"Add Consumer"))])]),t(o.OQ,[t(m.A,{ref:"form",model:{value:e.valid,callback:function(t){e.valid=t},expression:"valid"}},[t(v.A,[e.isEdit?e._e():t(l.A,{attrs:{cols:"12",sm:"12"}},[t(p.A,{staticClass:"mt-4",attrs:{items:e.consumerTypes,label:"Consumer Type",required:""},model:{value:e.editedItem.consumerType,callback:function(t){e.$set(e.editedItem,"consumerType",t)},expression:"editedItem.consumerType"}})],1),t(l.A,{attrs:{cols:"12",sm:"6"}},[t($.A,{directives:[{name:"mask",rawName:"v-mask",value:e.numberMask,expression:"numberMask"}],attrs:{label:"Account No.",disabled:e.isEdit,required:"",rules:e.contactNumberRules},model:{value:e.editedItem.accountNo,callback:function(t){e.$set(e.editedItem,"accountNo",t)},expression:"editedItem.accountNo"}})],1),t(l.A,{attrs:{cols:"12",sm:"6"}},[t(p.A,{attrs:{items:e.statusItems.filter((e=>"All"!==e)),label:"Status",required:""},model:{value:e.editedItem.status,callback:function(t){e.$set(e.editedItem,"status",t)},expression:"editedItem.status"}})],1),t(l.A,{attrs:{cols:"12",sm:"6"}},[t($.A,{directives:[{name:"mask",rawName:"v-mask",value:e.letterMask,expression:"letterMask"}],attrs:{label:"First Name",required:"",rules:e.accountNoRules},model:{value:e.editedItem.firstName,callback:function(t){e.$set(e.editedItem,"firstName",t)},expression:"editedItem.firstName"}})],1),t(l.A,{attrs:{cols:"12",sm:"6"}},[t($.A,{attrs:{label:"Middle Name"},model:{value:e.editedItem.middleName,callback:function(t){e.$set(e.editedItem,"middleName",t)},expression:"editedItem.middleName"}})],1),t(l.A,{attrs:{cols:"12",sm:"6"}},[t($.A,{directives:[{name:"mask",rawName:"v-mask",value:e.letterMask,expression:"letterMask"}],attrs:{label:"Last Name",required:"",rules:e.accountNoRules},model:{value:e.editedItem.lastName,callback:function(t){e.$set(e.editedItem,"lastName",t)},expression:"editedItem.lastName"}})],1),t(l.A,{attrs:{cols:"12",sm:"6"}},[t($.A,{attrs:{label:"Name Extension (e.g. Jr., Sr.)"},model:{value:e.editedItem.nameExtension,callback:function(t){e.$set(e.editedItem,"nameExtension",t)},expression:"editedItem.nameExtension"}})],1),t(l.A,{attrs:{cols:"12"}},[t($.A,{attrs:{label:"Full Address"},model:{value:e.editedItem.fullAddress,callback:function(t){e.$set(e.editedItem,"fullAddress",t)},expression:"editedItem.fullAddress"}})],1),t(l.A,{attrs:{cols:"12",sm:"6"}},[t(p.A,{attrs:{items:e.puroks.filter((e=>"All"!==e)),label:"Purok",required:""},model:{value:e.editedItem.purok,callback:function(t){e.$set(e.editedItem,"purok",t)},expression:"editedItem.purok"}})],1),t(l.A,{attrs:{cols:"12",sm:"6"}},[t($.A,{directives:[{name:"mask",rawName:"v-mask",value:e.numberMask,expression:"numberMask"}],attrs:{label:"Contact Number",rules:e.contactNumberRules},model:{value:e.editedItem.contactNumber,callback:function(t){e.$set(e.editedItem,"contactNumber",t)},expression:"editedItem.contactNumber"}})],1),t(l.A,{attrs:{cols:"12"}},[t($.A,{attrs:{label:"Email",rules:e.emailRules},model:{value:e.editedItem.email,callback:function(t){e.$set(e.editedItem,"email",t)},expression:"editedItem.email"}})],1)],1)],1)],1),t(o.SL,[t(A.A),t(a.A,{attrs:{text:"",disabled:e.isSaving},on:{click:e.closeDialog}},[e._v("Cancel")]),t(a.A,{attrs:{color:"primary",disabled:!e.valid||e.isSaving,loading:e.isSaving},on:{click:e.saveConsumer}},[e._v(" "+e._s(e.getActionButtonText)+" ")])],1)],1)],1),t(f.A,{attrs:{color:e.snackbarColor,timeout:"3000"},scopedSlots:e._u([{key:"action",fn:function({attrs:s}){return[t(a.A,e._b({attrs:{text:""},on:{click:function(t){e.snackbar=!1}}},"v-btn",s,!1),[e._v(" Close ")])]}}]),model:{value:e.snackbar,callback:function(t){e.snackbar=t},expression:"snackbar"}},[e._v(" "+e._s(e.snackbarText)+" ")]),t(d.A,{attrs:{"max-width":"400"},model:{value:e.confirmDialog,callback:function(t){e.confirmDialog=t},expression:"confirmDialog"}},[t(r.A,[t(o.ri,{staticClass:"text-h5"},[e._v("Confirm Action")]),t(o.OQ,[e._v(" Are you sure you want to "+e._s(e.confirmAction)+" this consumer? ")]),t(o.SL,[t(A.A),t(a.A,{attrs:{text:""},on:{click:function(t){e.confirmDialog=!1}}},[e._v("Cancel")]),t(a.A,{attrs:{color:"primary"},on:{click:e.executeToggleArchive}},[e._v("Confirm")])],1)],1)],1)],1)}),F=[],S=(s(4114),s(5353)),B={name:"ConsumerRecordsPage",data:()=>({breadcrumbs:[{text:"Home",disabled:!1,href:"/"},{text:"Consumer Records",disabled:!0}],search:"",statusFilter:"All",purokFilter:"All",archiveFilter:"Active",dialog:!1,valid:!1,isEdit:!1,snackbar:!1,snackbarText:"",snackbarColor:"",headers:[{text:"Account No.",value:"accountNo",sortable:!0},{text:"Name",value:"fullName",sortable:!0,sort:(e,t)=>e.fullName.localeCompare(t.fullName)},{text:"Address",value:"fullAddress",sortable:!0},{text:"Purok/Zone",value:"purok",sortable:!0},{text:"Contact",value:"contactNumber",sortable:!0},{text:"Status",value:"status",sortable:!0},{text:"Actions",value:"actions",sortable:!1}],statusItems:["All","active","inactive","disconnected","delinquent"],puroks:["All","Purok 1","Purok 2","Purok 3","Purok 4","Purok 5","Purok 6","Purok 7"],archiveItems:["Active","Archived","All"],editedItem:{accountNo:"",firstName:"",middleName:"",lastName:"",nameExtension:"",fullAddress:"",purok:"",contactNumber:"",email:"",status:"active",consumerType:"Existing Consumer"},defaultItem:{accountNo:"",firstName:"",middleName:"",lastName:"",nameExtension:"",fullAddress:"",purok:"",contactNumber:"",email:"",status:"active",consumerType:"Existing Consumer"},confirmDialog:!1,confirmAction:null,confirmItem:null,letterMask:Array(30).fill(/[A-Za-z]/),numberMask:Array(11).fill(/[0-9]/),activeTab:0,accountNoRules:[e=>!!e||"Account number is required",e=>/^[A-Za-z]+$/.test(e)||"Account number must contain letters only"],nameRules:[e=>(e||"").length>0||"Name is required",e=>(e||"").length>=2||"Name must be at least 2 characters"],contactNumberRules:[e=>!e||/^\d+$/.test(e)||"Contact number must contain numbers only"],emailRules:[e=>!e||/.+@.+\..+/.test(e)||"Invalid email format"],isSaving:!1,consumerTypes:["New Consumer","Existing Consumer"]}),computed:{...(0,S.aH)("consumers",["consumers","loading","error"]),userRole(){return this.$store.state.auth.user?.role},getActionButtonText(){return this.isEdit?"Update":"New Consumer"===this.editedItem.consumerType?"Process Payment":"Save"},filteredConsumers(){return this.consumers.filter((e=>{const t=this.search.toLowerCase(),s=!this.search||e.accountNo.toLowerCase().includes(t)||e.fullName.toLowerCase().includes(t),i="All"===this.statusFilter||e.status===this.statusFilter,a="All"===this.purokFilter||e.purok===this.purokFilter;return s&&i&&a&&!e.isArchived}))},filteredArchivedConsumers(){return this.consumers.filter((e=>{const t=this.search.toLowerCase(),s=!this.search||e.accountNo.toLowerCase().includes(t)||e.fullName.toLowerCase().includes(t),i="All"===this.statusFilter||e.status===this.statusFilter,a="All"===this.purokFilter||e.purok===this.purokFilter;return s&&i&&a&&e.isArchived}))}},async created(){await this.fetchConsumers()},methods:{...(0,S.i0)("consumers",["fetchConsumers","createConsumer","updateConsumer","archiveConsumer"]),getStatusColor(e){return{active:"success",inactive:"grey",delinquent:"error"}[e]||"grey"},applyFilters(){},resetFilters(){this.search="",this.statusFilter="All",this.purokFilter="All",this.archiveFilter="Active"},openAddDialog(){this.isEdit=!1,this.editedItem={...this.defaultItem},this.dialog=!0},editConsumer(e){this.isEdit=!0,this.editedItem={...e},this.dialog=!0},closeDialog(){this.dialog=!1,this.$nextTick((()=>{this.$refs.form&&(this.$refs.form.reset(),this.editedItem={...this.defaultItem})}))},async saveConsumer(){if(this.$refs.form.validate()){this.isSaving=!0;try{this.isEdit?(await this.updateConsumer({id:this.editedItem._id,consumer:this.editedItem}),this.snackbarText="Consumer updated successfully",this.snackbarColor="success",this.closeDialog()):"New Consumer"===this.editedItem.consumerType?(this.closeDialog(),this.$router.push({name:"Payments",query:{new:"true"},params:{newConsumer:!0,consumerData:{...this.editedItem,name:`${this.editedItem.firstName} ${this.editedItem.lastName}`}}})):(await this.createConsumer(this.editedItem),this.snackbarText="Consumer created successfully",this.snackbarColor="success",this.closeDialog()),await this.fetchConsumers()}catch(e){this.snackbarText=e.message||"Error saving consumer",this.snackbarColor="error",this.snackbar=!0}finally{this.isSaving=!1}}},confirmToggleArchive(e){this.confirmItem=e,this.confirmAction=e.isArchived?"restore":"archive",this.confirmDialog=!0},async executeToggleArchive(){try{await this.archiveConsumer({id:this.confirmItem._id}),this.snackbarText=this.confirmItem.isArchived?"Consumer restored":"Consumer archived",this.snackbarColor="success",await this.fetchConsumers()}catch(e){this.snackbarText=e.message||"Error updating archive status",this.snackbarColor="error"}finally{this.snackbar=!0,this.confirmDialog=!1}},async toggleArchive(e){try{const t=e.isArchived?"Restored by user":"Archived by user";await this.archiveConsumer({id:e._id,reason:t}),this.snackbarText=e.isArchived?"Consumer restored":"Consumer archived",this.snackbarColor="success",this.snackbar=!0,await this.fetchConsumers()}catch(t){this.snackbarText=t.message||"Error updating archive status",this.snackbarColor="error",this.snackbar=!0}},viewConsumer(e){this.$router.push(`/consumers/${e._id}`)},exportData(){console.log("export")}},watch:{"editedItem.consumerType"(){this.$refs.form&&this.$refs.form.validate()}}},D=B,P=s(1656),R=(0,P.A)(D,E,F,!1,null,"69188a72",null),G=R.exports},174:function(e,t,s){s(4114),s(8111),s(2489),s(116),s(7588);var i=s(5803),a=s(7717),r=s(7540),o=s(4152);t.A=(0,i.A)(a.A,(0,r.G)("form")).extend({name:"v-form",provide(){return{form:this}},inheritAttrs:!1,props:{disabled:Boolean,lazyValidation:Boolean,readonly:Boolean,value:Boolean},data:()=>({inputs:[],watchers:[],errorBag:{}}),watch:{errorBag:{handler(e){const t=Object.values(e).includes(!0);this.$emit("input",!t)},deep:!0,immediate:!0}},methods:{watchInput(e){const t=e=>e.$watch("hasError",(t=>{this.$set(this.errorBag,e._uid,t)}),{immediate:!0}),s={_uid:e._uid,valid:()=>{},shouldValidate:()=>{}};return this.lazyValidation?s.shouldValidate=e.$watch("shouldValidate",(i=>{i&&(this.errorBag.hasOwnProperty(e._uid)||(s.valid=t(e)))})):s.valid=t(e),s},validate(){return 0===this.inputs.filter((e=>!e.validate(!0))).length},reset(){this.inputs.forEach((e=>e.reset())),this.resetErrorBag()},resetErrorBag(){this.lazyValidation&&setTimeout((()=>{this.errorBag={}}),0)},resetValidation(){this.inputs.forEach((e=>e.resetValidation())),this.resetErrorBag()},register(e){this.inputs.push(e),this.watchers.push(this.watchInput(e))},unregister(e){const t=this.inputs.find((t=>t._uid===e._uid));if(!t)return;const s=this.watchers.find((e=>e._uid===t._uid));s&&(s.valid(),s.shouldValidate()),this.watchers=this.watchers.filter((e=>e._uid!==t._uid)),this.inputs=this.inputs.filter((e=>e._uid!==t._uid)),this.$delete(this.errorBag,t._uid)}},render(e){return e("form",{staticClass:"v-form",attrs:{novalidate:!0,...this.attrs$},on:{submit:e=>this.$emit("submit",e)}},(0,o.$c)(this))}})}}]);
//# sourceMappingURL=373.cf024e5a.js.map