"use strict";(self["webpackChunkclient"]=self["webpackChunkclient"]||[]).push([[437],{6437:function(t,e,s){s.r(e),s.d(e,{default:function(){return V}});var i=s(7314),a=s(3698),n=s(2938),o=s(569),r=s(6993),l=(s(4114),s(8111),s(2489),s(3579),s(4746)),c=s(5471),u=c.Ay.extend({name:"rippleable",directives:{ripple:l.A},props:{ripple:{type:[Boolean,Object],default:!0}},methods:{genRipple(t={}){return this.ripple?(t.staticClass="v-input--selection-controls__ripple",t.directives=t.directives||[],t.directives.push({name:"ripple",value:{center:!0}}),this.$createElement("div",t)):null}}}),h=s(8968),m=s(5803);function d(t){t.preventDefault()}var p=(0,m.A)(r.A,u,h.A).extend({name:"selectable",model:{prop:"inputValue",event:"change"},props:{id:String,inputValue:null,falseValue:null,trueValue:null,multiple:{type:Boolean,default:null},label:String},data(){return{hasColor:this.inputValue,lazyValue:this.inputValue}},computed:{computedColor(){if(this.isActive)return this.color?this.color:this.isDark&&!this.appIsDark?"white":"primary"},isMultiple(){return!0===this.multiple||null===this.multiple&&Array.isArray(this.internalValue)},isActive(){const t=this.value,e=this.internalValue;return this.isMultiple?!!Array.isArray(e)&&e.some((e=>this.valueComparator(e,t))):void 0===this.trueValue||void 0===this.falseValue?t?this.valueComparator(t,e):Boolean(e):this.valueComparator(e,this.trueValue)},isDirty(){return this.isActive},rippleState(){return this.isDisabled||this.validationState?this.validationState:void 0}},watch:{inputValue(t){this.lazyValue=t,this.hasColor=t}},methods:{genLabel(){const t=r.A.options.methods.genLabel.call(this);return t?(t.data.on={click:d},t):t},genInput(t,e){return this.$createElement("input",{attrs:Object.assign({"aria-checked":this.isActive.toString(),disabled:this.isDisabled,id:this.computedId,role:t,type:t},e),domProps:{value:this.value,checked:this.isActive},on:{blur:this.onBlur,change:this.onChange,focus:this.onFocus,keydown:this.onKeydown,click:d},ref:"input"})},onClick(t){this.onChange(),this.$emit("click",t)},onChange(){if(!this.isInteractive)return;const t=this.value;let e=this.internalValue;if(this.isMultiple){Array.isArray(e)||(e=[]);const s=e.length;e=e.filter((e=>!this.valueComparator(e,t))),e.length===s&&e.push(t)}else e=void 0!==this.trueValue&&void 0!==this.falseValue?this.valueComparator(e,this.trueValue)?this.falseValue:this.trueValue:t?this.valueComparator(e,t)?null:t:!e;this.validate(!0,e),this.internalValue=e,this.hasColor=e},onFocus(t){this.isFocused=!0,this.$emit("focus",t)},onBlur(t){this.isFocused=!1,this.$emit("blur",t)},onKeydown(t){}}}),v=p.extend({name:"v-checkbox",props:{indeterminate:Boolean,indeterminateIcon:{type:String,default:"$checkboxIndeterminate"},offIcon:{type:String,default:"$checkboxOff"},onIcon:{type:String,default:"$checkboxOn"}},data(){return{inputIndeterminate:this.indeterminate}},computed:{classes(){return{...r.A.options.computed.classes.call(this),"v-input--selection-controls":!0,"v-input--checkbox":!0,"v-input--indeterminate":this.inputIndeterminate}},computedIcon(){return this.inputIndeterminate?this.indeterminateIcon:this.isActive?this.onIcon:this.offIcon},validationState(){if(!this.isDisabled||this.inputIndeterminate)return this.hasError&&this.shouldValidate?"error":this.hasSuccess?"success":null!==this.hasColor?this.computedColor:void 0}},watch:{indeterminate(t){this.$nextTick((()=>this.inputIndeterminate=t))},inputIndeterminate(t){this.$emit("update:indeterminate",t)},isActive(){this.indeterminate&&(this.inputIndeterminate=!1)}},methods:{genCheckbox(){const{title:t,...e}=this.attrs$;return this.$createElement("div",{staticClass:"v-input--selection-controls__input"},[this.$createElement(o.A,this.setTextColor(this.validationState,{props:{dense:this.dense,dark:this.dark,light:this.light}}),this.computedIcon),this.genInput("checkbox",{...e,"aria-checked":this.inputIndeterminate?"mixed":this.isActive.toString()}),this.genRipple(this.setTextColor(this.rippleState))])},genDefaultSlot(){return[this.genCheckbox(),this.genLabel()]}}}),y=s(3180),f=s(4414),b=s(3449),g=s(9483),A=s(8983),C=s(7296),k=s(2659),_=s(8519),I=s(2756),x=s(7150),w=s(7112),T=function(){var t=this,e=t._self._c;return e(b.A,{staticClass:"pa-0",attrs:{fluid:""}},[e(a.A,{staticClass:"mb-4",attrs:{flat:""}},[e(n.OQ,[e("div",{staticClass:"text-caption grey--text mb-1"},[t._v(" Home / Payments / New Payment ")]),e("div",{staticClass:"text-h5 primary--text font-weight-bold"},[t._v("New Payment")])])],1),e(b.A,[e(I.A,[e(f.A,{attrs:{cols:"12",md:"8"}},[e(a.A,[e(n.ri,{staticClass:"grey lighten-4"},[t._v("Payment Processing")]),e(n.OQ,[e(I.A,{staticClass:"grey lighten-5 pa-4 mb-4"},[e(f.A,{attrs:{cols:"12",sm:"6",md:"3"}},[e("div",{staticClass:"caption grey--text"},[t._v("Account No.")]),e("div",{staticClass:"body-1 font-weight-medium"},[t._v(" "+t._s(t.consumer.accountNo)+" ")])]),e(f.A,{attrs:{cols:"12",sm:"6",md:"3"}},[e("div",{staticClass:"caption grey--text"},[t._v("Consumer Name")]),e("div",{staticClass:"body-1 font-weight-medium"},[t._v(" "+t._s(t.consumer.name)+" ")])]),e(f.A,{attrs:{cols:"12",sm:"6",md:"3"}},[e("div",{staticClass:"caption grey--text"},[t._v("Consumer Type")]),e(y.A,{attrs:{"x-small":"",color:"warning",label:""}},[t._v(t._s(t.consumer.type))])],1),e(f.A,{attrs:{cols:"12",sm:"6",md:"3"}},[e("div",{staticClass:"caption grey--text"},[t._v("Status")]),e("div",{staticClass:"body-1 font-weight-medium"},[t._v(" "+t._s(t.consumer.status)+" ")])])],1),e("div",{staticClass:"mb-6"},[e("div",{staticClass:"text-subtitle-1 primary--text font-weight-medium mb-3"},[t._v(" Select Transactions ")]),e(a.A,{attrs:{outlined:""}},[e(A.A,t._l(t.displayedFees,(function(s,i){return e(C.A,{key:i},[e(k.A,[e(v,{attrs:{disabled:s.disabled},model:{value:s.selected,callback:function(e){t.$set(s,"selected",e)},expression:"fee.selected"}})],1),e(_.pr,[e(_.UZ,[t._v(t._s(s.name))]),e(_.w,{staticClass:"text-caption"},[t._v(" "+t._s(s.description)+" ")])],1),e(k.A,[t._v("₱"+t._s(s.amount.toFixed(2)))])],1)})),1)],1)],1),e("div",{staticClass:"mb-6"},[e("div",{staticClass:"text-subtitle-1 primary--text font-weight-medium mb-3"},[t._v(" Payment Details ")]),e(w.A,{attrs:{label:"Amount Received",prefix:"₱",type:"number",outlined:"",dense:"","error-messages":t.amountReceivedError,min:"0",step:"0.01"},model:{value:t.amountReceived,callback:function(e){t.amountReceived=e},expression:"amountReceived"}}),e(a.A,{staticClass:"grey lighten-5 mb-4",attrs:{outlined:""}},[e(C.A,[e(_.pr,[t._v("Amount Received")]),e(k.A,[t._v("₱"+t._s(t.amountReceived))])],1),e(C.A,[e(_.pr,[t._v("Total Amount Due")]),e(k.A,[t._v("₱"+t._s(t.totalAmountDue.toFixed(2)))])],1),e(g.A),e(C.A,[e(_.pr,[t._v("Change")]),e(k.A,{staticClass:"success--text font-weight-bold"},[t._v(" ₱"+t._s(t.calculateChange.toFixed(2))+" ")])],1)],1)],1)],1)],1)],1),e(f.A,{attrs:{cols:"12",md:"4"}},[e(a.A,[e(n.ri,{staticClass:"primary white--text"},[t._v("Transaction Summary")]),e(n.OQ,{staticClass:"pt-4"},[t._l(t.summaryItems,(function(s,i){return e(C.A,{key:i},[e(_.pr,[e(_.UZ,[t._v(t._s(s.name))])],1),e(k.A,[t._v("₱"+t._s(s.amount.toFixed(2)))])],1)})),e(g.A,{staticClass:"my-4"}),e(C.A,{staticClass:"font-weight-bold"},[e(_.pr,[e(_.UZ,[t._v("Total Amount Due")])],1),e(k.A,[t._v("₱"+t._s(t.totalAmountDue.toFixed(2)))])],1),e(i.A,{staticClass:"mt-6",attrs:{color:"primary",block:"",disabled:!t.isValidPayment||!!t.amountReceivedError,loading:t.loading},on:{click:t.processPayment}},[t._v(" "+t._s(t.loading?"Processing...":"Process Payment")+" ")]),e(i.A,{staticClass:"mt-2",attrs:{block:"",text:"",disabled:t.loading},on:{click:t.cancel}},[t._v(" Cancel ")])],2)],1)],1)],1)],1),e(x.A,{attrs:{color:t.snackbarColor,timeout:"3000"},scopedSlots:t._u([{key:"action",fn:function({attrs:s}){return[e(i.A,t._b({attrs:{text:""},on:{click:function(e){t.snackbar=!1}}},"v-btn",s,!1),[t._v("Close")])]}}]),model:{value:t.snackbar,callback:function(e){t.snackbar=e},expression:"snackbar"}},[t._v(" "+t._s(t.snackbarText)+" ")])],1)},B=[],$=(s(116),s(7588),s(1701),s(8237),s(5353)),D={name:"PaymentPage",data:()=>({consumer:{accountNo:"",name:"",type:"",status:""},fees:[{name:"Current Bill",amount:0,selected:!0,disabled:!0,description:"Current water bill payment",paymentType:"BILL_PAYMENT"},{name:"Unpaid Balance",amount:0,selected:!0,disabled:!0,description:"Unpaid balance",paymentType:"BILL_PAYMENT"},{name:"Membership Fee",amount:300,selected:!1,disabled:!1,description:"One-time membership fee for new consumers",paymentType:"MEMBERSHIP_FEE"},{name:"Reconnection Fee",amount:50,selected:!1,disabled:!1,description:"Water reconnection service fee",paymentType:"RECONNECTION_FEE"}],amountReceived:0,loading:!1,snackbar:!1,snackbarText:"",snackbarColor:""}),computed:{...(0,$.aH)("consumers",["currentConsumer"]),...(0,$.aH)("billings",["currentBill"]),displayedFees(){if("true"===this.$route.query.newConsumer)return this.fees.filter((t=>"Membership Fee"===t.name));let t=this.fees.filter((t=>"Current Bill"===t.name));const e=this.fees.find((t=>"Unpaid Balance"===t.name));if(e&&e.amount>0&&t.push(e),"disconnected"===this.consumer.status.toLowerCase()){const e=this.fees.find((t=>"Reconnection Fee"===t.name));e&&t.push(e)}return t},summaryItems(){return this.fees.filter((t=>t.selected)).map((t=>({name:t.name,amount:t.amount,description:t.description,paymentType:t.paymentType,billId:t.billId,billIds:t.billIds})))},totalAmountDue(){return this.summaryItems.reduce(((t,e)=>t+e.amount),0)},calculateChange(){return this.amountReceived-this.totalAmountDue},isValidPayment(){return this.amountReceived>=this.totalAmountDue&&this.totalAmountDue>0},amountReceivedError(){return this.amountReceived<this.totalAmountDue?"Amount received must be greater than or equal to total amount due":""}},watch:{amountReceived(t){const e=parseFloat(t);this.amountReceived=e<0?0:e}},async created(){await this.initializePaymentData()},methods:{...(0,$.i0)("consumers",["fetchConsumerById"]),...(0,$.i0)("billings",["fetchBillById","fetchUnpaidBills","updateBill"]),async initializePaymentData(){try{if("true"===this.$route.query.new){const t=this.$route.params.consumerData;this.consumer={accountNo:t.accountNo,name:`${t.firstName} ${t.lastName}`,type:t.consumerType,status:t.status},this.fees=this.fees.filter((t=>"Membership Fee"===t.name));const e=this.fees[0];e&&(e.selected=!0,e.disabled=!0,this.amountReceived=e.amount)}else{const t=await this.fetchBillById(this.$route.query.billId),e=await this.fetchConsumerById(this.$route.query.consumerId);this.consumer={accountNo:e.accountNo,name:`${e.firstName} ${e.lastName}`,type:e.consumerType||"old",status:e.status};const s=this.fees.find((t=>"Current Bill"===t.name));s&&(s.amount=t.amount,s.billId=t._id);const i=await this.fetchUnpaidBills(this.$route.query.consumerId),a=i.filter((e=>e._id!==t._id)),n=a.reduce(((t,e)=>t+e.amount),0),o=this.fees.find((t=>"Unpaid Balance"===t.name));if(o&&(o.amount=n,o.billIds=a.map((t=>t._id))),"disconnected"===e.status.toLowerCase()){const t=this.fees.find((t=>"Reconnection Fee"===t.name));t&&(t.selected=!0,t.disabled=!1)}}}catch(t){this.snackbarText="Error initializing payment data",this.snackbarColor="error",this.snackbar=!0}},async processPayment(){if(this.isValidPayment&&!this.amountReceivedError){this.loading=!0;try{const t=this.summaryItems.filter((t=>"BILL_PAYMENT"===t.paymentType)),e={consumerId:this.$route.query.consumerId,amount:this.totalAmountDue,amountReceived:parseFloat(this.amountReceived),change:this.calculateChange,paymentType:t.length>0?"BILL_PAYMENT":this.summaryItems[0].paymentType,selectedFees:this.summaryItems,paymentMethod:"CASH",status:"completed",notes:`Payment for ${this.summaryItems.map((t=>t.name)).join(", ")}`},s=[];if(this.$route.query.billId&&s.push({id:this.$route.query.billId,amount:this.fees.find((t=>"Current Bill"===t.name)).amount}),this.fees.find((t=>"Unpaid Balance"===t.name))?.amount>0){const t=await this.fetchUnpaidBills(this.$route.query.consumerId);t.forEach((t=>{t._id!==this.$route.query.billId&&s.push({id:t._id,amount:t.amount})}))}for(const i of s)await this.updateBill({id:i.id,bill:{status:"paid",paidAmount:i.amount,paymentDate:new Date}});await this.$store.dispatch("payments/createPayment",e),this.snackbarText="Payment processed successfully",this.snackbarColor="success",this.snackbar=!0,setTimeout((()=>{this.$router.push({name:"Billing"})}),2e3)}catch(t){this.snackbarText=t.message||"Error processing payment",this.snackbarColor="error",this.snackbar=!0}finally{this.loading=!1}}},cancel(){confirm("Are you sure you want to cancel? Any unsaved changes will be lost.")&&this.$router.push({name:"true"===this.$route.query.newConsumer?"ConsumerRecords":"Billing"})}}},P=D,E=s(1656),R=(0,E.A)(P,T,B,!1,null,"b463aa86",null),V=R.exports},7150:function(t,e,s){s.d(e,{A:function(){return h}});var i=s(8184),a=s(8743),n=s(3381),o=s(428),r=s(6763),l=s(5803),c=s(4152),u=s(6988),h=(0,l.A)(i.A,a.A,o.A,(0,r.P)(["absolute","bottom","left","right","top"])).extend({name:"v-snackbar",props:{app:Boolean,centered:Boolean,contentClass:{type:String,default:""},multiLine:Boolean,text:Boolean,timeout:{type:[Number,String],default:5e3},transition:{type:[Boolean,String],default:"v-snack-transition",validator:t=>"string"===typeof t||!1===t},vertical:Boolean},data:()=>({activeTimeout:-1}),computed:{classes(){return{"v-snack--absolute":this.absolute,"v-snack--active":this.isActive,"v-snack--bottom":this.bottom||!this.top,"v-snack--centered":this.centered,"v-snack--has-background":this.hasBackground,"v-snack--left":this.left,"v-snack--multi-line":this.multiLine&&!this.vertical,"v-snack--right":this.right,"v-snack--text":this.text,"v-snack--top":this.top,"v-snack--vertical":this.vertical}},hasBackground(){return!this.text&&!this.outlined},isDark(){return this.hasBackground?!this.light:n.A.options.computed.isDark.call(this)},styles(){if(this.absolute||!this.app)return{};const{bar:t,bottom:e,footer:s,insetFooter:i,left:a,right:n,top:o}=this.$vuetify.application;return{paddingBottom:(0,c.Dg)(e+s+i),paddingLeft:(0,c.Dg)(a),paddingRight:(0,c.Dg)(n),paddingTop:(0,c.Dg)(t+o)}}},watch:{isActive:"setTimeout",timeout:"setTimeout"},mounted(){this.isActive&&this.setTimeout()},created(){this.$attrs.hasOwnProperty("auto-height")&&(0,u.rq)("auto-height",this),0==this.timeout&&(0,u.CI)('timeout="0"',"-1",this)},methods:{genActions(){return this.$createElement("div",{staticClass:"v-snack__action "},[(0,c.$c)(this,"action",{attrs:{class:"v-snack__btn"}})])},genContent(){return this.$createElement("div",{staticClass:"v-snack__content",class:{[this.contentClass]:!0},attrs:{role:"status","aria-live":"polite"}},[(0,c.$c)(this)])},genWrapper(){const t=this.hasBackground?this.setBackgroundColor:this.setTextColor,e=t(this.color,{staticClass:"v-snack__wrapper",class:i.A.options.computed.classes.call(this),style:i.A.options.computed.styles.call(this),directives:[{name:"show",value:this.isActive}],on:{pointerenter:()=>window.clearTimeout(this.activeTimeout),pointerleave:this.setTimeout}});return this.$createElement("div",e,[this.genContent(),this.genActions()])},genTransition(){return this.$createElement("transition",{props:{name:this.transition}},[this.genWrapper()])},setTimeout(){window.clearTimeout(this.activeTimeout);const t=Number(this.timeout);this.isActive&&![0,-1].includes(t)&&(this.activeTimeout=window.setTimeout((()=>{this.isActive=!1}),t))}},render(t){return t("div",{staticClass:"v-snack",class:this.classes,style:this.styles},[!1!==this.transition?this.genTransition():this.genWrapper()])}})}}]);
//# sourceMappingURL=437.4868d890.js.map