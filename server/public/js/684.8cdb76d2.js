"use strict";(self["webpackChunkclient"]=self["webpackChunkclient"]||[]).push([[684],{4684:function(e,t,s){s.r(t),s.d(t,{default:function(){return _}});var a=s(6103),i=s(7314),r=s(1484),l=s(2938),o=s(3180),c=s(4414),n=s(3449),d=s(3064),u=s(1289),m=s(174),h=s(6930),A=s(2756),v=s(2197),p=s(7150),b=s(1034),f=s(7112),k=(s(8111),s(2489),function(){var e=this,t=e._self._c;return t(n.A,{staticClass:"px-6"},[t("div",{staticClass:"mb-6"},[t(a.A,{staticClass:"pa-0",attrs:{items:e.breadcrumbs,divider:"/"}})],1),t(r.A,{staticClass:"mb-6"},[t(l.OQ,[t(A.A,[t(c.A,{attrs:{cols:"12",sm:"6",md:"3"}},[t(f.A,{attrs:{label:"Search",placeholder:"Account No. / Name",dense:"",outlined:"","hide-details":"","prepend-inner-icon":"mdi-magnify"},model:{value:e.search,callback:function(t){e.search=t},expression:"search"}})],1),t(c.A,{attrs:{cols:"12",sm:"6",md:"3"}},[t(v.A,{attrs:{items:e.statusItems,label:"Status",dense:"",outlined:"","hide-details":""},model:{value:e.statusFilter,callback:function(t){e.statusFilter=t},expression:"statusFilter"}})],1),t(c.A,{attrs:{cols:"12",sm:"6",md:"3"}},[t(v.A,{attrs:{items:e.puroks,label:"Purok",dense:"",outlined:"","hide-details":""},model:{value:e.purokFilter,callback:function(t){e.purokFilter=t},expression:"purokFilter"}})],1),t(c.A,{attrs:{cols:"12",sm:"6",md:"3"}},[t(v.A,{attrs:{items:e.archiveItems,label:"Archive Status",dense:"",outlined:"","hide-details":""},model:{value:e.archiveFilter,callback:function(t){e.archiveFilter=t},expression:"archiveFilter"}})],1)],1),t(A.A,{staticClass:"mt-4"},[t(b.A),t(i.A,{staticClass:"mr-2",attrs:{text:""},on:{click:e.resetFilters}},[e._v("Reset")]),t(i.A,{attrs:{color:"primary"},on:{click:e.applyFilters}},[e._v("Apply Filter")])],1)],1)],1),t(r.A,[t(l.ri,{staticClass:"d-flex justify-space-between py-4"},[t("span",{staticClass:"text-h6"},[e._v("Consumer List")]),t("div",[t(i.A,{staticClass:"mr-2",attrs:{text:""},on:{click:e.exportData}},[t(h.A,{attrs:{left:""}},[e._v("mdi-download")]),e._v(" Export ")],1),t(i.A,{attrs:{color:"primary"},on:{click:e.openAddDialog}},[t(h.A,{attrs:{left:""}},[e._v("mdi-plus")]),e._v(" Add Consumer ")],1)],1)]),t(d.A,{attrs:{headers:e.headers,items:e.filteredConsumers,loading:e.loading,"items-per-page":10,"footer-props":{"items-per-page-options":[10,20,50],"show-first-last-page":!0}},scopedSlots:e._u([{key:"item.status",fn:function({item:s}){return[t(o.A,{attrs:{color:e.getStatusColor(s.status),small:"",label:"","text-color":"white"}},[e._v(" "+e._s(s.status)+" ")])]}},{key:"item.actions",fn:function({item:s}){return[t(i.A,{staticClass:"mr-2",attrs:{"x-small":"",text:"",color:"primary"},on:{click:function(t){return e.editConsumer(s)}}},[t(h.A,{attrs:{"x-small":"",left:""}},[e._v("mdi-pencil")]),e._v(" Edit ")],1),t(i.A,{attrs:{"x-small":"",text:"",color:s.isArchived?"success":"error"},on:{click:function(t){return e.toggleArchive(s)}}},[t(h.A,{attrs:{"x-small":"",left:""}},[e._v(" "+e._s(s.isArchived?"mdi-archive-restore":"mdi-archive")+" ")]),e._v(" "+e._s(s.isArchived?"Restore":"Archive")+" ")],1)]}}])})],1),t(u.A,{attrs:{"max-width":"600px"},model:{value:e.dialog,callback:function(t){e.dialog=t},expression:"dialog"}},[t(r.A,[t(l.ri,[t("span",{staticClass:"text-h5"},[e._v(e._s(e.isEdit?"Edit Consumer":"Add Consumer"))])]),t(l.OQ,[t(m.A,{ref:"form",model:{value:e.valid,callback:function(t){e.valid=t},expression:"valid"}},[t(A.A,[e.isEdit?e._e():t(c.A,{attrs:{cols:"12",sm:"12"}},[t(v.A,{staticClass:"mt-4",attrs:{items:e.consumerTypes,label:"Consumer Type",required:""},model:{value:e.editedItem.consumerType,callback:function(t){e.$set(e.editedItem,"consumerType",t)},expression:"editedItem.consumerType"}})],1),t(c.A,{attrs:{cols:"12",sm:"6"}},[t(f.A,{attrs:{label:"Account No.",disabled:e.isEdit,required:""},model:{value:e.editedItem.accountNo,callback:function(t){e.$set(e.editedItem,"accountNo",t)},expression:"editedItem.accountNo"}})],1),t(c.A,{attrs:{cols:"12",sm:"6"}},[t(v.A,{attrs:{items:e.statusItems.filter((e=>"All"!==e)),label:"Status",required:""},model:{value:e.editedItem.status,callback:function(t){e.$set(e.editedItem,"status",t)},expression:"editedItem.status"}})],1),t(c.A,{attrs:{cols:"12",sm:"6"}},[t(f.A,{attrs:{label:"First Name",required:"",rules:e.nameRules},model:{value:e.editedItem.firstName,callback:function(t){e.$set(e.editedItem,"firstName",t)},expression:"editedItem.firstName"}})],1),t(c.A,{attrs:{cols:"12",sm:"6"}},[t(f.A,{attrs:{label:"Middle Name"},model:{value:e.editedItem.middleName,callback:function(t){e.$set(e.editedItem,"middleName",t)},expression:"editedItem.middleName"}})],1),t(c.A,{attrs:{cols:"12",sm:"6"}},[t(f.A,{attrs:{label:"Last Name",required:"",rules:e.nameRules},model:{value:e.editedItem.lastName,callback:function(t){e.$set(e.editedItem,"lastName",t)},expression:"editedItem.lastName"}})],1),t(c.A,{attrs:{cols:"12",sm:"6"}},[t(f.A,{attrs:{label:"Name Extension (e.g. Jr., Sr.)"},model:{value:e.editedItem.nameExtension,callback:function(t){e.$set(e.editedItem,"nameExtension",t)},expression:"editedItem.nameExtension"}})],1),t(c.A,{attrs:{cols:"12"}},[t(f.A,{attrs:{label:"Full Address"},model:{value:e.editedItem.fullAddress,callback:function(t){e.$set(e.editedItem,"fullAddress",t)},expression:"editedItem.fullAddress"}})],1),t(c.A,{attrs:{cols:"12",sm:"6"}},[t(v.A,{attrs:{items:e.puroks.filter((e=>"All"!==e)),label:"Purok/Zone",required:""},model:{value:e.editedItem.purok,callback:function(t){e.$set(e.editedItem,"purok",t)},expression:"editedItem.purok"}})],1),t(c.A,{attrs:{cols:"12",sm:"6"}},[t(f.A,{attrs:{label:"Contact Number",rules:e.phoneRules},model:{value:e.editedItem.contactNumber,callback:function(t){e.$set(e.editedItem,"contactNumber",t)},expression:"editedItem.contactNumber"}})],1),t(c.A,{attrs:{cols:"12"}},[t(f.A,{attrs:{label:"Email",rules:e.emailRules},model:{value:e.editedItem.email,callback:function(t){e.$set(e.editedItem,"email",t)},expression:"editedItem.email"}})],1)],1)],1)],1),t(l.SL,[t(b.A),t(i.A,{attrs:{text:"",disabled:e.isSaving},on:{click:e.closeDialog}},[e._v("Cancel")]),t(i.A,{attrs:{color:"primary",disabled:!e.valid||e.isSaving,loading:e.isSaving},on:{click:e.saveConsumer}},[e._v(" "+e._s(e.getActionButtonText)+" ")])],1)],1)],1),t(p.A,{attrs:{color:e.snackbarColor,timeout:"3000"},scopedSlots:e._u([{key:"action",fn:function({attrs:s}){return[t(i.A,e._b({attrs:{text:""},on:{click:function(t){e.snackbar=!1}}},"v-btn",s,!1),[e._v(" Close ")])]}}]),model:{value:e.snackbar,callback:function(t){e.snackbar=t},expression:"snackbar"}},[e._v(" "+e._s(e.snackbarText)+" ")])],1)}),C=[],x=(s(4114),s(5353)),I={name:"ConsumerRecordsPage",data:()=>({breadcrumbs:[{text:"Home",disabled:!1,href:"/"},{text:"Consumer Records",disabled:!0}],search:"",statusFilter:"All",purokFilter:"All",archiveFilter:"Active",dialog:!1,valid:!1,isEdit:!1,snackbar:!1,snackbarText:"",snackbarColor:"",headers:[{text:"Account No.",value:"accountNo",sortable:!0},{text:"Name",value:"fullName",sortable:!0,sort:(e,t)=>e.fullName.localeCompare(t.fullName)},{text:"Address",value:"fullAddress",sortable:!0},{text:"Purok/Zone",value:"purok",sortable:!0},{text:"Contact",value:"contactNumber",sortable:!0},{text:"Status",value:"status",sortable:!0},{text:"Actions",value:"actions",sortable:!1}],statusItems:["All","active","inactive","disconnected","delinquent"],puroks:["All","Purok 1","Purok 2","Purok 3","Purok 4","Purok 5"],archiveItems:["Active","Archived","All"],editedItem:{accountNo:"",firstName:"",middleName:"",lastName:"",nameExtension:"",fullAddress:"",purok:"",contactNumber:"",email:"",status:"active",consumerType:"Existing Consumer"},defaultItem:{accountNo:"",firstName:"",middleName:"",lastName:"",nameExtension:"",fullAddress:"",purok:"",contactNumber:"",email:"",status:"active",consumerType:"Existing Consumer"},nameRules:[e=>(e||"").length>0||"Name is required",e=>(e||"").length>=2||"Name must be at least 2 characters"],phoneRules:[e=>!e||/^\+?[\d\s-]{10,}$/.test(e)||"Invalid phone number format"],emailRules:[e=>!e||/.+@.+\..+/.test(e)||"Invalid email format"],isSaving:!1,consumerTypes:["New Consumer","Existing Consumer"]}),computed:{...(0,x.aH)("consumers",["consumers","loading","error"]),getActionButtonText(){return this.isEdit?"Update":"New Consumer"===this.editedItem.consumerType?"Process Payment":"Save"},filteredConsumers(){return this.consumers.filter((e=>{const t=this.search.toLowerCase(),s=!this.search||e.accountNo.toLowerCase().includes(t)||e.firstName.toLowerCase().includes(t)||e.middleName?.toLowerCase().includes(t)||e.lastName.toLowerCase().includes(t)||e.nameExtension?.toLowerCase().includes(t)||e.fullName.toLowerCase().includes(t),a="All"===this.statusFilter||e.status===this.statusFilter,i="All"===this.purokFilter||e.purok===this.purokFilter,r="All"===this.archiveFilter||("Archived"===this.archiveFilter?e.isArchived:!e.isArchived);return s&&a&&i&&r}))}},async created(){await this.fetchConsumers()},methods:{...(0,x.i0)("consumers",["fetchConsumers","createConsumer","updateConsumer","archiveConsumer"]),getStatusColor(e){return{active:"success",inactive:"grey",delinquent:"error"}[e]||"grey"},applyFilters(){},resetFilters(){this.search="",this.statusFilter="All",this.purokFilter="All",this.archiveFilter="Active"},openAddDialog(){this.isEdit=!1,this.editedItem={...this.defaultItem},this.dialog=!0},editConsumer(e){this.isEdit=!0,this.editedItem={...e},this.dialog=!0},closeDialog(){this.dialog=!1,this.$nextTick((()=>{this.$refs.form&&(this.$refs.form.reset(),this.editedItem={...this.defaultItem})}))},async saveConsumer(){if(this.$refs.form.validate()){this.isSaving=!0;try{this.isEdit?(await this.updateConsumer({id:this.editedItem._id,consumer:this.editedItem}),this.snackbarText="Consumer updated successfully",this.snackbarColor="success",this.closeDialog()):"New Consumer"===this.editedItem.consumerType?(this.closeDialog(),this.$router.push({name:"Payments",query:{new:"true"},params:{newConsumer:!0,consumerData:{...this.editedItem,name:`${this.editedItem.firstName} ${this.editedItem.lastName}`}}})):(await this.createConsumer(this.editedItem),this.snackbarText="Consumer created successfully",this.snackbarColor="success",this.closeDialog()),await this.fetchConsumers()}catch(e){this.snackbarText=e.message||"Error saving consumer",this.snackbarColor="error",this.snackbar=!0}finally{this.isSaving=!1}}},async toggleArchive(e){try{const t=e.isArchived?"Restored by user":"Archived by user";await this.archiveConsumer({id:e._id,reason:t}),this.snackbarText=e.isArchived?"Consumer restored":"Consumer archived",this.snackbarColor="success",this.snackbar=!0,await this.fetchConsumers()}catch(t){this.snackbarText=t.message||"Error updating archive status",this.snackbarColor="error",this.snackbar=!0}},viewConsumer(e){this.$router.push(`/consumers/${e._id}`)},exportData(){console.log("export")}},watch:{"editedItem.consumerType"(){this.$refs.form&&this.$refs.form.validate()}}},N=I,g=s(1656),y=(0,g.A)(N,k,C,!1,null,"17cdd4cb",null),_=y.exports}}]);
//# sourceMappingURL=684.8cdb76d2.js.map