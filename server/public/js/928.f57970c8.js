"use strict";(self["webpackChunkclient"]=self["webpackChunkclient"]||[]).push([[928],{3928:function(e,t,s){s.r(t),s.d(t,{default:function(){return w}});var a=s(6103),r=s(7314),i=s(1484),l=s(2938),o=s(3180),c=s(4414),n=s(3449),d=s(3064),u=s(1289),m=s(174),h=s(6930),v=s(2756),f=s(2197),b=s(7150),p=s(1034),A=s(7112),k=function(){var e=this,t=e._self._c;return t(n.A,{staticClass:"px-6"},[t("div",{staticClass:"mb-6"},[t(a.A,{staticClass:"pa-0",attrs:{items:e.breadcrumbs,divider:"/"}})],1),t(i.A,{staticClass:"mb-6"},[t(l.OQ,[t(v.A,[t(c.A,{attrs:{cols:"12",sm:"6",md:"4"}},[t(A.A,{attrs:{label:"Search",placeholder:"Username / Name / Email",dense:"",outlined:"","hide-details":"","prepend-inner-icon":"mdi-magnify"},on:{keyup:function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:e.fetchUsers.apply(null,arguments)}},model:{value:e.search,callback:function(t){e.search=t},expression:"search"}})],1)],1)],1)],1),t(i.A,[t(l.ri,{staticClass:"d-flex justify-space-between py-4"},[t("span",{staticClass:"text-h6"},[e._v("User List")]),t(r.A,{attrs:{color:"primary"},on:{click:e.openAddDialog}},[t(h.A,{attrs:{left:""}},[e._v("mdi-plus")]),e._v(" Add User ")],1)],1),t(d.A,{attrs:{headers:e.headers,items:e.filteredUsers,loading:e.loading,"items-per-page":10,"footer-props":{"items-per-page-options":[10,20,50],"show-first-last-page":!0}},scopedSlots:e._u([{key:"item.role",fn:function({item:s}){return[t(o.A,{attrs:{color:e.getRoleColor(s.role),small:"",label:""}},[e._v(" "+e._s(e.formatRole(s.role))+" ")])]}},{key:"item.status",fn:function({item:s}){return[t(o.A,{attrs:{color:e.getStatusColor(s.status),small:"",label:"","text-color":"white"}},[e._v(" "+e._s(s.status)+" ")])]}},{key:"item.actions",fn:function({item:s}){return[t(r.A,{staticClass:"mr-2",attrs:{"x-small":"",text:"",color:"primary"},on:{click:function(t){return e.editUser(s)}}},[t(h.A,{attrs:{"x-small":"",left:""}},[e._v("mdi-pencil")]),e._v(" Edit ")],1),t(r.A,{attrs:{"x-small":"",text:"",color:s.isArchived?"success":"error"},on:{click:function(t){return e.confirmArchive(s)}}},[t(h.A,{attrs:{"x-small":"",left:""}},[e._v("mdi-archive")]),e._v(" Archive ")],1)]}}])})],1),t(u.A,{attrs:{"max-width":"600px",persistent:""},model:{value:e.dialog,callback:function(t){e.dialog=t},expression:"dialog"}},[t(i.A,[t(l.ri,[t("span",{staticClass:"text-h5"},[e._v(e._s(e.isEdit?"Edit User":"Add User"))])]),t(l.OQ,[t(m.A,{ref:"form",model:{value:e.valid,callback:function(t){e.valid=t},expression:"valid"}},[t(v.A,[t(c.A,{attrs:{cols:"12",sm:"6"}},[t(A.A,{attrs:{label:"Username",required:"",disabled:e.isEdit,rules:e.usernameRules},model:{value:e.editedItem.username,callback:function(t){e.$set(e.editedItem,"username",t)},expression:"editedItem.username"}})],1),t(c.A,{attrs:{cols:"12",sm:"6"}},[t(f.A,{attrs:{items:e.roles,label:"Role",required:"",rules:[e=>!!e||"Role is required"]},model:{value:e.editedItem.role,callback:function(t){e.$set(e.editedItem,"role",t)},expression:"editedItem.role"}})],1),t(c.A,{attrs:{cols:"12",sm:"6"}},[t(A.A,{attrs:{label:"First Name",required:"",rules:e.nameRules},model:{value:e.editedItem.firstName,callback:function(t){e.$set(e.editedItem,"firstName",t)},expression:"editedItem.firstName"}})],1),t(c.A,{attrs:{cols:"12",sm:"6"}},[t(A.A,{attrs:{label:"Last Name",required:"",rules:e.nameRules},model:{value:e.editedItem.lastName,callback:function(t){e.$set(e.editedItem,"lastName",t)},expression:"editedItem.lastName"}})],1),t(c.A,{attrs:{cols:"12",sm:"6"}},[t(A.A,{attrs:{label:"Email",required:"",rules:e.emailRules},model:{value:e.editedItem.email,callback:function(t){e.$set(e.editedItem,"email",t)},expression:"editedItem.email"}})],1),t(c.A,{attrs:{cols:"12",sm:"6"}},[t(A.A,{attrs:{label:"Contact Number",rules:e.phoneRules},model:{value:e.editedItem.contactNumber,callback:function(t){e.$set(e.editedItem,"contactNumber",t)},expression:"editedItem.contactNumber"}})],1),t(c.A,{attrs:{cols:"12",sm:"6"}},[t(f.A,{attrs:{items:e.statusItems,label:"Status",required:"",rules:[e=>!!e||"Status is required"]},model:{value:e.editedItem.status,callback:function(t){e.$set(e.editedItem,"status",t)},expression:"editedItem.status"}})],1),e.isEdit?e._e():t(c.A,{attrs:{cols:"12"}},[t(A.A,{attrs:{label:"Password",type:"password",required:"",rules:e.passwordRules},model:{value:e.editedItem.password,callback:function(t){e.$set(e.editedItem,"password",t)},expression:"editedItem.password"}})],1)],1)],1)],1),t(l.SL,[t(p.A),t(r.A,{attrs:{text:"",disabled:e.isSaving},on:{click:e.closeDialog}},[e._v("Cancel")]),t(r.A,{attrs:{color:"primary",disabled:!e.valid||e.isSaving,loading:e.isSaving},on:{click:e.saveUser}},[e._v(" Save ")])],1)],1)],1),t(u.A,{attrs:{"max-width":"400px"},model:{value:e.archiveDialog,callback:function(t){e.archiveDialog=t},expression:"archiveDialog"}},[t(i.A,[t(l.ri,{staticClass:"text-h5"},[e._v("Archive User")]),t(l.OQ,[e._v(" Are you sure you want to archive this user? "),t(A.A,{staticClass:"mt-4",attrs:{label:"Reason for archiving",required:""},model:{value:e.archiveReason,callback:function(t){e.archiveReason=t},expression:"archiveReason"}})],1),t(l.SL,[t(p.A),t(r.A,{attrs:{text:""},on:{click:function(t){e.archiveDialog=!1}}},[e._v("Cancel")]),t(r.A,{attrs:{color:"error",disabled:!e.archiveReason},on:{click:e.handleArchive}},[e._v(" Archive ")])],1)],1)],1),t(b.A,{attrs:{color:e.snackbarColor,timeout:"3000"},scopedSlots:e._u([{key:"action",fn:function({attrs:s}){return[t(r.A,e._b({attrs:{text:""},on:{click:function(t){e.snackbar=!1}}},"v-btn",s,!1),[e._v("Close")])]}}]),model:{value:e.snackbar,callback:function(t){e.snackbar=t},expression:"snackbar"}},[e._v(" "+e._s(e.snackbarText)+" ")])],1)},g=[],x=(s(8111),s(2489),s(1701),s(5353)),I={name:"UsersPage",data:()=>({breadcrumbs:[{text:"Home",disabled:!1,href:"/"},{text:"Users",disabled:!0}],search:"",dialog:!1,archiveDialog:!1,archiveReason:"",userToArchive:null,valid:!1,isEdit:!1,snackbar:!1,snackbarText:"",snackbarColor:"",isSaving:!1,headers:[{text:"Username",value:"username",sortable:!0},{text:"Name",value:"fullName",sortable:!0},{text:"Role",value:"role",sortable:!0},{text:"Email",value:"email",sortable:!0},{text:"Contact",value:"contactNumber",sortable:!0},{text:"Status",value:"status",sortable:!0},{text:"Actions",value:"actions",sortable:!1}],roles:["admin","meter_reader","collection_officer"],statusItems:["active","inactive"],editedItem:{username:"",password:"",firstName:"",lastName:"",role:"",email:"",contactNumber:"",status:"active"},defaultItem:{username:"",password:"",firstName:"",lastName:"",role:"",email:"",contactNumber:"",status:"active"},usernameRules:[e=>null!==e&&void 0!==e&&e.length>0||"Username is required",e=>null!==e&&void 0!==e&&e.length>=3||"Username must be at least 3 characters"],nameRules:[e=>null!==e&&void 0!==e&&e.length>0||"Name is required",e=>null!==e&&void 0!==e&&e.length>=2||"Name must be at least 2 characters"],emailRules:[e=>null!==e&&void 0!==e&&e.length>0||"Email is required",e=>null===e||void 0===e||/.+@.+\..+/.test(e)||"Invalid email format"],phoneRules:[e=>!e||/^\+?[\d\s-]{10,}$/.test(e)||"Invalid phone number format"]}),computed:{...(0,x.aH)("users",["users","loading","error"]),passwordRules(){return[e=>!this.isEdit||!!e||"Password is required",e=>!this.isEdit||e.length>=8||"Password must be at least 8 characters"]},filteredUsers(){return this.users.filter((e=>{const t=this.search.toLowerCase();return!this.search||e.username.toLowerCase().includes(t)||e.firstName.toLowerCase().includes(t)||e.lastName.toLowerCase().includes(t)||e.email.toLowerCase().includes(t)})).map((e=>({...e,fullName:`${e.firstName} ${e.lastName}`})))}},async created(){await this.fetchUsers()},methods:{...(0,x.i0)("users",["fetchUsers","createUser","updateUser","archiveUser"]),formatRole(e){return e.split("_").map((e=>e.charAt(0).toUpperCase()+e.slice(1))).join(" ")},getRoleColor(e){return{admin:"red",meter_reader:"blue",collection_officer:"green"}[e]||"grey"},getStatusColor(e){return{active:"success",inactive:"error"}[e]||"grey"},openAddDialog(){this.isEdit=!1,this.editedItem={...this.defaultItem},this.dialog=!0},editUser(e){this.isEdit=!0,this.editedItem={...e},delete this.editedItem.password,this.dialog=!0},closeDialog(){this.dialog=!1,this.$nextTick((()=>{this.$refs.form&&(this.$refs.form.reset(),this.editedItem={...this.defaultItem})}))},confirmArchive(e){this.userToArchive=e,this.archiveReason="",this.archiveDialog=!0},async handleArchive(){if(this.archiveReason)try{await this.archiveUser({id:this.userToArchive._id,reason:this.archiveReason}),this.snackbarText="User archived successfully",this.snackbarColor="success",this.archiveDialog=!1,await this.fetchUsers()}catch(e){this.snackbarText=e.message||"Error archiving user",this.snackbarColor="error"}finally{this.snackbar=!0}},async saveUser(){if(this.$refs.form.validate()){this.isSaving=!0;try{const e={...this.editedItem};this.isEdit?(delete e._id,delete e.fullName,delete e.createdAt,delete e.updatedAt,await this.updateUser({id:this.editedItem._id,userData:e}),this.snackbarText="User updated successfully"):(await this.createUser(e),this.snackbarText="User created successfully"),this.snackbarColor="success",this.closeDialog(),await this.fetchUsers()}catch(e){this.snackbarText=e.message||"Error saving user",this.snackbarColor="error"}finally{this.isSaving=!1,this.snackbar=!0}}}},watch:{dialog(e){e||this.closeDialog()}}},_=I,C=s(1656),U=(0,C.A)(_,k,g,!1,null,"ba4269ea",null),w=U.exports}}]);
//# sourceMappingURL=928.f57970c8.js.map